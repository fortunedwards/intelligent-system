{% extends "base.html" %}

{% block title %}Dashboard - Course Scheduler{% endblock %}

{% block content %}
<div class="px-40 flex flex-1 justify-center py-5">
    <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
        <div class="flex flex-wrap justify-between gap-3 p-4">
            <p class="text-[#111418] tracking-light text-[32px] font-bold leading-tight min-w-72">Dashboard</p>
            <div class="flex items-center gap-3">
                <button id="generate-btn" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#0d78f2] text-white text-sm font-bold leading-normal tracking-[0.015em] min-w-0" onclick="window.location.href='{{ url_for('generate_timetable') }}'">
                    <span class="truncate">Generate New Timetable</span>
                </button>
            </div>
        </div>
        
        <div class="p-4">
            <div class="flex flex-wrap justify-between gap-3 mb-4">
                <p class="text-[#111418] tracking-light text-xl font-bold leading-tight">Saved Timetables</p>
            </div>
            {% if saved_timetables %}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for timetable in saved_timetables %}
                <div class="bg-white p-4 rounded-lg shadow-md border border-gray-200">
                    <h3 class="font-bold text-lg text-gray-900">{{ timetable.timestamp[:10] }}</h3>
                    <p class="text-sm text-gray-600">Saved at: {{ timetable.timestamp[11:16] }}</p>
                    <div class="mt-4 flex gap-2">
                        <a href="{{ url_for('view_saved_timetable', timetable_id=timetable._id) }}" class="flex-1 text-center py-2 px-4 bg-[#e5e7eb] hover:bg-[#d1d5db] text-[#111418] rounded-lg text-sm font-medium">View</a>
                        <button onclick="deleteTimetable('{{ timetable._id }}')" class="flex-1 text-center py-2 px-4 bg-[#f87171] hover:bg-[#dc2626] text-white rounded-lg text-sm font-medium">Delete</button>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-gray-500 text-center py-8">
                <p>No saved timetables found.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    function deleteTimetable(timetableId) {
        if (confirm("Are you sure you want to delete this timetable?")) {
            fetch(`/delete/saved_timetables/${timetableId}`, {
                method: 'DELETE'
            }).then(response => {
                if (response.ok) {
                    location.reload();
                } else {
                    alert("Failed to delete timetable.");
                }
            });
        }
    }
</script>
{% endblock %}