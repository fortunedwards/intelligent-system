{% extends "base.html" %}

{% block title %}Dashboard - Timetable Generator{% endblock %}

{% block content %}
<div class="px-40 flex flex-1 justify-center py-5">
    <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
        <div class="flex flex-wrap justify-between gap-3 p-4">
            <p class="text-[#111418] tracking-light text-[32px] font-bold leading-tight min-w-72">Dashboard</p>
            <div class="flex items-center gap-3">
                <button
                    id="generate-btn"
                    class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-8 px-4 bg-[#f0f2f5] text-[#111418] text-sm font-medium leading-normal"
                    onclick="window.location.href='{{ url_for('generate_timetable_route') }}'"
                >
                    <span class="truncate">Generate New Timetable</span>
                </button>
            </div>
        </div>
        
        <h2 class="text-[#111418] text-[22px] font-bold leading-tight tracking-[-0.015em] px-4 pb-3 pt-5">Saved Timetables</h2>
        
        {% if saved_timetables %}
        <div class="p-4 grid grid-cols-2 gap-4">
            {% for timetable in saved_timetables %}
            <div class="flex items-center justify-between gap-4 p-4 rounded-lg bg-white shadow">
                <div class="flex-1">
                    <p class="text-[#111418] text-base font-semibold leading-normal">{{ timetable.name }}</p>
                    <p class="text-[#49739c] text-sm font-normal leading-normal">Created on {{ timetable.created_at }}</p>
                </div>
                <div class="flex items-center gap-2">
                    <a href="{{ url_for('view_saved_timetable', timetable_id=timetable._id) }}" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-8 px-4 bg-[#f0f2f5] text-[#111418] text-sm font-medium leading-normal w-fit">
                        <span class="truncate">View</span>
                    </a>
                    <button onclick="deleteTimetable('{{ timetable._id }}')" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-8 px-4 bg-red-600 text-white text-sm font-medium leading-normal w-fit">
                        <span class="truncate">Delete</span>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-gray-500 text-center py-8">
            <p>No saved timetables found.</p>
        </div>
        {% endif %}
    </div>
</div>

<script>
    function deleteTimetable(timetableId) {
        if (confirm("Are you sure you want to delete this timetable?")) {
            fetch(`/delete_saved_timetable/${timetableId}`, {
                method: 'POST'
            }).then(response => response.json())
              .then(result => {
                  if (result.success) {
                      alert(result.message);
                      window.location.reload();
                  } else {
                      alert('Failed to delete timetable: ' + result.message);
                  }
              })
              .catch(error => {
                  console.error('Error:', error);
                  alert('An error occurred while trying to delete the timetable.');
              });
        }
    }
</script>
{% endblock %}